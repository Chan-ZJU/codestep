# 因特网

什么是因特网？

可以从因特网的**组成**和**应用**两方面来看。

## 组成

因特网是由个人电脑，手机，汽车等一系列能够连接上网设备所组成，而这些设备统称为主机或端系统。所以因特网是由主机或端系统组成。

端系统与端系统之间通过 **通信链路** 和 **分组交换** 连接到一起。

通信链路就是我们日常所见到的电缆，存在很多种类型。例如铜线，光纤等。通信链路传输信息的快慢用**传输速率**来衡量，也就是 bit/s 或 bps ，表示每秒传输信息的多少。

当两个端系统之间进行通信时会将数据拆分成好多段，并且会在每一段里面加上一些信息，也就是首部字节。然后好多这样的信息放在一起变成了包。这个过程叫做**分组** 。 这些分组再通过网络发送到对应的端系统上，然后再组装到一起。

而分组交换机的作用就是用来转发分组，根据入通信链路接受到分组，再根据出通信两路将分组发出去，不断的将分组传送到目的地。

分组交换机分路由器和链路层交换机两种类型。前者处于网络的核心位置，而后者则是处于接入网中。

端系统通过因特网服务（ISP）提供上接入互联网中。而 ISP 本身就是多台分组交换机和多段通信链路组成的互联网。

ISP 提供多种方式接入互联网中，例如光纤，DSL，移动无线接入等。所以因特网就是将端系统连接起来。

而 ISP 本身也是需要连接到互联网上，连接了更高一层的 ISP 上。ISP 本身是独立管理运行着 IP 协议，遵守着命名和地址规则。

端系统，分组交换机和其他的组成部分都需要遵守一些列协议，这些协议控制着信息的发送与接收。其中 TCP/IP 则是两个非常重要的协议。IP 协议定义了路由器和端系统至今啊发送接受数据的分组格式，

协议的一致性非常重要，有专门的组织在制定统一的标准。因特网协议则是由因特网工程任务组（IETF）研发，IETF 的标准文档称为请求评论（RFC），RFC 详细的定义了很多协议，例如TCP，IP，HTTP等。

### 服务
从服务的角度来看待因特网，例如网站，网站存放在服务器上，也就是端系统之上。而这个网站可以在不同的主机上呗访问到，提供相应的服务。着就是分布式应用程序。手机中 APP 也是这样，例如微信，接受发送消息均需要经过微信的服务器。

与因特网相连的端系统提供了**套接字接口**，这些接口规定了不同端系统之间数据交付的方式。

## 协议
协议就是一系列的规定和针对相应事件的流程。

## 网络
之前提过连接在因特网上的所有设备都称为端系统或主机。而进一步可以将端系统划分为客户端和服务器端两种类型。

客户端通常指个人电脑，手机等设备。而服务器端则指存放资源的端系统。例如当访问网页时通过手机（客户端）看到的网页就是从服务器中发送过来的。

# 接入网
接入网指端系统物理连接到边缘路由器的网络，而边缘路由器就是端系统到其他任何远程终端路径上的第一台路由器。

接入方式总体上分为家庭接入，企业接入，广域无线接入三种。

### 家庭接入

* 家庭接入也就是将家里的电脑等终端设备连上网，也就是连上宽带。而连上宽带的方式比较流行的有数字用户线（DSL）和电缆两种类型。

数字用户线是借用了电话线来传送信息，通过电话线实现了上网的功能。电话线一般是双绞铜线，可以用不同的频率进行编码。分为三个级别：高速下行信道（50kHz - 1MHz），中速上行信道（4kHz - 50kHz），普通的双向电话信道（0 - 4kHz）

用户家里有一个 DSL 调制解调器，将得到的数字数据转换为高频音。然后通过电话线传送给本地中心局（co）。因为存在多个家庭，co 里面有一个复用器（DSLAM）用于交换数据，将许多家庭的模拟信号在 DSLAM 上转换为数字形式，然后将数据送到因特网上。

DSL 定制了不同的传输速率，这个速率和距离，价格都有一定的关系。一般而言距离 CO 不是 5 - 10 英里内的话需要用别的方式接入因特网。

* 电缆因特网接入，利用了有线电视来接入实现上网功能。

材质一般采用光纤和同轴电缆混合的方式，也称为混合光纤同轴系统（HFC）。其中 CO 到相应地区枢纽采用光纤连接，而地区到达各家各户采用同轴电缆连接。 

在电缆头端，同样存在和 DSLAM 相同的功能 CMTS 用来将所有家庭传送过来的模拟信号转换为数字形式。HFC 将网络划分为下行和上行两个信道，下行信道比上行信道速率高，分别是: 42.8Mbps 30.7Mbps ，理论上是这样，但是由于实际中传输损耗的存在会使得速率小于理论值。

电缆因特网最重要的特征是共享广播媒体，带来的问题也就是用的人越多越卡。用的人少时速度快。因为上行信道是共享的所以也存在碰撞。

* 光纤到户（FTTH）
光纤到户意味着从本地中心局到用户家中的链接全部采用光纤。根据连接的方式存在两种形式，一种是一家占用一条线，另一种是一条总线，快到用户家里了才分出一条支线。

根据以上的分配方式出现了两种光纤分布体系：有源光纤网络（AON）和无源光纤网络（PON），AON 的本质是交换以太网，这个以后再说。

PON 的流程是，线看本地电话中心是怎么连接上网的，本地电话中心通过光缆拿到了用户家中传过来的光信号，本地电话中心通过光纤线路端接收器（OLT）将光信号转化为电信号，然后经过本地电话中心的路由器连接上因特网。

再来看用户和本地电话中心之间的连接，用户家里面由路由器，路由器和光纤网络端接收器相连接（ONT），再由专门的光纤连接到邻近的分配器上。分配器实现了将多个家庭几种到一起根光纤上，家庭数目一般少于 100 个。

FTTH 有潜力提供每秒千兆比特范围的因特网接入速率。

### 企业接入

* 在公司或者大学校园中一般采用局域网（LAN）将端系统连接到边缘路由器上

局域网技术有很多，其中以太网是最流行的。速度方面用户可以达到 100Mbps 或 1Gbps，服务器则可以达到 1Gbps 或 10Gbps 的接入速率

除此之外还有无线接入，也就是 WIFI 。

虽然以太网和 WIFI 最初是企业接入的，但是现如今家庭一般都有 WIFI 不仅仅在企业接入中。

### 广域无线接入
* 广域无线接入就是 3G/4G/5G 也就是日常使用的流量。可以通过数万米外的基站实现入网。除此之外还有来源于 3G 技术的 LTE 。

## 物理媒体
物理媒体有多种类型，根据信号传播的介质可以分为导引型媒体和非导引型媒体。

导引型就是有线的，例如铜线，光缆或同轴电缆。非导引型是无线的，例如 WIFI，电磁波等这种在空气或者在外层空间（例如太空）中传播的信号。

1. 双绞铜线：日常生活中最常见的传导介质。电话线大都是由两根绝缘铜线组成，为防止电气干扰两根铜线螺旋缠绕。速度一般为 10Mbps - 10Gbps ，速度还取绝与线的粗细和传输方式以及接受方式。
2. 同轴电缆：两个导体同心的而非并行。可被作为导引型的共享媒体。
3. 光纤：以光脉冲的形式发送信号，一个脉冲表示一个比特。速率极高，难以窃听但是造价昂贵。
4. 陆地无线点信道：无线传播，不依赖物理线路可穿透墙壁。但是穿透物体时会使得信号的强度降低。根据距离可大致分为三类：短距离一到两米。局域传播十米到几百米，一般用于个人设备。广域传播数万米，一般用于无线 LAN，蜂窝接入技术。
5. 卫星无线电信道：卫星上面装有微波发射器和接收器，在一个频段上接受传输，然后再使用另一个转发器再生信号并在另一个频率上发射。存在同步卫星和近地轨道两种类型的卫星。


# 网络核心
互联网的核心由端系统的**分组交换机**和**链路构成的网状网络**。

## 分组交换技术
端系统彼此之间通过报文来发送信息，而报文既可以执行一些控制功能也可以承载一些数据。

将长报文划分成较小的数据块称为分组，而分组则通过通信链路和分组交换机（路由器/链路层交换机）将信息从源主机发往目的主机。

1. 存储转发传输

路由器只有接受到完整的报文后才会将报文送出去，而途中接受到的部分报文会缓存下来，直到拿到完整的报文。

假设导线的传输速率为 R 比特每秒，信息为 L 比特 ，而传输这段信息所需要的时间就是 $L/R$ 

假设两个主 a/b 机之间存在一个路由器 t，主机 a 向主机 b 发送信息需要经过路由器 t 的转发。主机a 向路由器 t 发生数据所消耗的时延为 $L/R$ ，而当路由器完全接受这段信息后再向主机 b 发送这段信息所需要的时延为 $L/R$ 。所以总时延就是 $2L/R$

而如果主机 a 和主机 b 之间没有路由器 t 的话，传输这段信息所消耗的时延为 $L/R$

当有 N 条速率为 R 的链路组成的路径的时延为 $d=N\frac{L}{R}$

2. 排队时延

当分组到达路由器后，路由器有多条链路可以选择，选择一个合适的链路将这个当前分组送往目的地。而每一条链路都对应一个输出队列，也叫输出缓存。只有当前的数据报发出去后才从输出队列中取出发送下一个分组。如果输出队列满了的话，那么当前想要加入的分组就会被丢弃，也就是分组丢包。

3. 转发表和路由选择协议

路由器是如何为分组选择合适的链路的？当分组到达路由器后，路由器中存了一张**转发表**，根据分组里面的目的地址或者目的地址的一部分，路由器根据转发表将目的地址映射出一条输出链路。

而转发表这是根据**路由选择协议**配置出来的。路由选择协议决定了路由器到目的地的最短路，并使用最短路的结果来配置转发表。至于转发表和路由选择协议后续会详解。

## 电路交换
电路交换是提前建立了连接，将方面方面都打点好，建立起自己的传输通道，预留了所需要的资源，以恒定的速率传输信息。而分组交换则是车道山前必有路，走一步看一步，毕竟提供的是尽最大努力的交付，传不到我也没办法。

电路交换是建立一条真实的物理通道，随时可以通信，例如电话，但是如果电话连着不说话，也就是处于静默期的话，这些资源还是被占用的。所以这些资源是浪费了。而分组交换则可以充分利用所有资源。

1. 电路交换网络中的复用

2. 分组交换和电路交换的对比

##  网络的网络

网络结构1：

网络结构2：

网络结构3：

网络结构4：

网络结构5：

# 分组交换中的时延，丢包和吞吐量

## 时延

##

# 协议层次及其服务类型

# 网络攻击

# 历史

# 总结

