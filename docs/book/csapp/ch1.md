# 第一章：计算机系统漫游

计算机系统是由**硬件**和**系统软件**组成，二者共同工作来运行应用程序。

虽然硬件和系统软件的实现方式随着时间的改变是不同的，但是**概念**却是不变的。

通过了解这些概念可以明白这些组件是如何影响程序的正确性和性能，以便于提高自身技能。

本质上来说，这本书就是讲代码从编写到运行所经历的过程。

例如使用 C 语言编写一段代码（hello.c）到最终运行出来的过程。

通过这个过程可以了解到系统**发生了什么**以及**为什么会这样**。

```cpp
#include <stdio.h>
int main() {
    printf("hello world\n");
    return 0;
}
```

后续部分就是讲 hello 程序从编写到运行，最终输出内容这个过程中涉及到的东西。

# 1.1 信息就是位 + 上下文

程序是通过编写**源代码**开始的，源代码本身则是**字符**组成。

代码虽然都是字符，但是运行的源程序实际上是由 0 或 1 组成。

8 个 0/1 的组合构成一组，称为**字节**，而字节则表示程序中的一个**字符**。

ASCII 标准是常见的编码方式，每个字符都对应着相应的数字。例如字符 # 表示十进制下的 35 。

每行代码的末尾都**隐式**的存在一个**换行符** '\n' 。

# 1.2 程序被其他程序翻译称不同的格式

C 语言是**高级语言**，是便于人使用，阅读的产物。但是机器只能读懂 0/1 ，也就是二进制的信息。所以 C 语言需要经过**翻译**，最终变成 CPU 可以识别的**二进制形式**的**可执行文件**，也就是程序。

从编写好的代码到变成真正的程序会进行**预处理**，**编译**，**汇编**和**链接**几个步骤，最终产生一个**二进制**形式的**可执行文件**。

* **预处理阶段**，预处理机（cpp）会将以字符 # 开头的代码修改为原始的 C 程序。以 # 开头代码实际上是调用 C 语言编写好的库代码。例如 `#include <stdlib.h>` 表示调用系统头文件 `stdlib.h` 中的代码，可以理解为将代码插入当前位置。然后会产生一个扩展名为 .i 结尾的文件。例如 hello.i 。当前阶段就执行完了。
* **编译阶段**，编译器（ccl）会将文本文件 hello.i **翻译**成文本文件 hello.s 。也就是翻译成汇编语言。
* **汇编阶段**，汇编器（as）会将文本文件 hello.c 翻译成二进制文件 hello.o 。注意这个二进制文件中只包含函数 main() 中的指令。
* **链接阶段**，连接器（ld）会将程序涉及到的文件链接起来，因为调用了输出函数 `printf()` ，而该函数存在于 C 函数库中`printf.o` 文件内，所以连接器会将其整合起来形成 hello 文件，这就是一个可执行文件。

经过上面的四个阶段后，将最终产生的可执行文件载入内存中，由系统执行。

# 1.3 了解编译系统如何工作是大有益处的

编译系统将 C 语言转换成机器代码的过程中是容易产生问题的。

除此之外了解汇编过程是非常有用的，通过查看机器码以及编译方式可以更细粒度的明白哪些 C 语言编写方式执行起来更快速。

例如 switch 和 if-else 的组合哪个更高效，函数调用的开销多少，while 循环和 for 循环那个更快等等。

理解链接时出现的错误。避免程序在连接时可能或产生错误。

避免安全漏洞。编写更为安全的代码。

# 1.4 处理器读并解释储存在内存中的指令。

下一步就是执行 hello 文件了。

通过 shell 来执行文件，可以直接键入文件名来执行。

shell 是一个命令解释器，输入命令，然后执行，shell 会判断该命令是不是内置的 shell 命令，如果是就按照设定的执行，反之后假设是可执行文件的名字，然后加载并运行该文件。

## 1.4.1 系统的硬件组成

了解执行 hello 程序运行过程需要先了解系统的硬件组成。

1. 总线

总线负责携带信息字节在各个部件之间传递。如果将信息理解成水流的话，那么总线就是管道。

通常总线是运送的是定长的字节块，也就是字。字有长度，也就是字长，指字节数。字长通常有 4 个字节或者 8 个字节。也是 32 位或 64 位。

2. I/O 设备

系统同外界交互的渠道，常见的 I/O 设备有鼠标，键盘，显示器，以及磁盘等。

I/O 设备通过**控制器**或者**适配器**和 I/O 总线相连。

控制器和适配器随有不同，但是二者都是承担 I/O 设备和 I/O 总线之间传递信息的作用。

3. 主存

主存指临时存储器，用来存放程序或程序处理的数据。

物理上主存是由动态随机存取存储器组成，逻辑上主存就是线性的字节数组。

4. 处理器

处理器即 CPU，中央处理单元。


## 1.4.2 运行 hello 程序

# 1.5 高速缓存至关重要

# 1.6 存储设备形成层次结构

# 1.7 操作系统管理硬件

# 1.8 系统之间利用网络通信

# 1.9 重要主题

# 1.10 小结

